■はじめに, Introduction
　・ダウンロードして頂き、ありがとうございます。
　・本ファイルは本プログラムのシステム要件、使い方、注意点などを記載しています。
　・ご使用の前にご一読ください。


■ファイル説明, File Description
  main.py 		  → 変換プログラム
  start.bat 		  → プログラムを実行するためのもの(Pathが通っていることが前提)
  OmniMIDI_Settings.reg   → 私がOmniMIDIで使っている設定のファイル。
  Sine Wave Soundfont.sf2 → 主にOmniMIDIなどで使うサウンドフォント。標準のMIDIの音を正弦波に変えてくれる。
  使い方.txt 		  → 今見ているテキストファイル。
  README.md 		  → Githubでの説明用。


■概要, Outline
　・このツールは任意のWAVファイルをフーリエ変換を利用して、なるべく元ファイルと同じ聞こえ方をするようにMIDIへと変換するものです。
　・ある程度の知識があればプログラムをいじって自分好みにカスタマイズできますが、綺麗なコードになっていないのでご注意を。


■システム要件, System requirement
　OS：  Windows11
　CPU:  Pythonが動かせるもの。
　RAM:  16GB以上推奨。元が5分程度の曲で6GBぐらい使う。


■アンインストール, How to uninstall
　・このファイルのあるフォルダごとゴミ箱に捨てる。


■前提ソフト, Required Software
  ・Audacity 3.4.2 - 3.6.4
  ・Python   3.10.6 - 3.12.6
  ・OmniMIDI 14.8.5 (正弦波が合成できれば基本的に何でもよい)
  ・MIDI再生ソフト (おすすめはTom's MIDI Player)


■前提ライブラリ, Required Library
  numpy, scipy, mido, tqdm をコマンドプロンプトを使ってインストールする。
  -> pip install numpy scipy mido tqdm

  ・numpy  (1.26.4 - 2.1.1)
  ・scipy  (1.12.0 - 1.14.1)
  ・mido   (1.3.2)
  ・tqdm   (4.66.5)


■変換方法, Conversion Procedure
　以下の手順を実行してください。
  1. Audacityを起動し、MIDIにしたい音声ファイルをドラッグアンドドロップ、音声トラックの左下辺りの何もないところをクリックし、上のタブから 「トラック>ミックス>ステレオをモノラルにミックスダウン」 の順に操作(元からモノラルの場合はこの手順は無視する)
  2. 「エフェクト→ピッチとテンポ→テンポを変更」 から、下の "高品質なストレッチを使用" にチェックを入れて、変更率を "-93.750" にする。
  3. 「エフェクト>音量と圧縮>増幅」 をクリックし、そのまま適用をクリックする。
　4. 「ファイル>オーディオをエクスポート」 をクリックし、形式は "WAV (Microsoft)" 、サンプリング周波数は元のまま、エンコーディングは "Signed 16-bit PCM" にして、コンピュータに問題が発生しない場所に好きな名前で書き出す(エクスポート)
　5．このテキストファイルがあるフォルダに "start.bat" という名前のバッチファイルがあるので起動し、新しく出てきたウィンドウから先ほど書き出したファイルを見つけてダブルクリックする。
　6．処理が終わるまで気長に待つ。
　7．しばらくすると、4番で書き出した時の名前のMIDIファイルが生成され、さらにコマンドプロンプトが閉じる(処理が終わる)のを待つと再生できるようになる。
  8．Tom's MIDI Playerなどを使って聴く。


■大事な点, Important point
  ・2番は、サンプリング周波数が高いと時間がかかるときがあるため、44100Hzなどの一般的なサンプリング周波数に落としてから行っても問題はない。
  ・2番の変更率の-93.750とは16倍のこと。
  ・3番はMIDIでの音量を良い感じにするために必要。
  ・4番のときに、エンコーディングを16bit以外にすると変換できないため気をつける必要がある。
  ・6番のときに、RAMがシステムの限界に近づきすぎるとパソコンがおかしくなる可能性があるため、残り2~4GBぐらいになってしまったら強制終了させる。

　・1/16倍速された音声データを対象としているため、上記の2番の手順を行わないとMIDIの再生速度が16倍になる。
  ・音量の目安は、Audacityで「解析>Measure RMS」の"Mono:"の値が、-14~-18dbの範囲に収まっていれば問題ない。
  ・元とまったく同じ聴こえ方にはならないので、EQフィルターなどで事前に聴こえ方を調整しても問題ない。
　・MIDIの再生にはOmniMIDIやシンセサイザー等を利用して、正弦波でMIDIデータを合成して聴く。
   (なお、環境によって同じMIDIデータでも聴こえ方が変わる)


■音質を上げる場合, When you want to improve sound quality
  1. 変換方法の2番の手順の前にサンプリング周波数を176400に変更し、2番の手順が終わったら44100Hzに戻す。
　2. プログラムの32行目の「if volume > min_vol:」を「if volume > 1:」に置き換える。
  3. プログラムの64行目の「max_volume *= 0.35」を「max_volume *= 0.4」に置き換える。

  ※音質を上げた場合、変換時の時間が増加します。また、再生時の計算量が大幅に増加し、再生不良や音飛びが発生する可能性があります。
    通常使用において、1番の手順は実行しても問題ありませんが、プログラムは元のまま使う方が良いです。


■最後に, Finally
　・このテキストファイルの内容は変更を加える可能性があります。
　・本プログラムは完全無料です。改変は許可しますが、再配布を禁じます。
　・本プログラムを使用したことによる如何なる損害について責任は一切負いません。


編集:Bistanium
最終編集日:2024/09/24
